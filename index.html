<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Akatombo - Full Score</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸªˆ</text></svg>"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Noto Sans JP', sans-serif;
        background: white;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
      }

      header {
        flex-shrink: 0;
        padding: 10px 20px;
      }

      h1 {
        font-size: 1.2rem;
        margin-bottom: 5px;
        font-weight: 300;
      }

      .subtitle {
        color: #666;
        font-size: 0.8rem;
      }

      #display {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        overflow: auto;
      }

      #display.debug svg {
        border: 2px solid #e74c3c;
      }

      .error {
        color: #e74c3c;
        padding: 20px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1 id="score-title">Loading...</h1>
      <p class="subtitle" id="score-subtitle">
        <span id="debug-indicator"></span>
      </p>
    </header>

    <div id="display"></div>

    <script type="module">
      import { renderScoreFromURL } from '/src/renderer/convenience';

      const display = document.getElementById('display');

      // Parse URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const showDebugLabels =
        urlParams.get('debug') === 'true' ||
        urlParams.get('romanji') === 'true';
      const showOctaveMarks = urlParams.get('octaveMarks') !== 'false';

      // Update debug indicator
      if (showDebugLabels) {
        document.getElementById('debug-indicator').innerHTML =
          'Debug: ON - ?debug=true found in URL';
        display.classList.add('debug');
      }

      // Render score
      (async () => {
        try {
          const renderer = await renderScoreFromURL(
            display,
            '/data/Akatombo.musicxml',
            {
              showOctaveMarks,
              showDebugLabels,
            }
          );

          // Update page metadata from score data
          const scoreData = renderer.getScoreData();
          if (scoreData) {
            document.getElementById('score-title').textContent = scoreData.title;
            const subtitleElement = document.getElementById('score-subtitle');
            const debugIndicator = document.getElementById('debug-indicator');
            subtitleElement.textContent = scoreData.composer || '';
            if (debugIndicator) {
              subtitleElement.appendChild(debugIndicator);
            }
          }
        } catch (error) {
          console.error('Error:', error);
          display.innerHTML = `<div class="error">Error: ${error.message}</div>`;
        }
      })();
    </script>
  </body>
</html>
