<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ScoreParser Test - Akatombo</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü™à</text></svg>">
  <style>
    body {
      font-family: 'Noto Sans JP', sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      background: #f5f5f5;
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #4CAF50;
      padding-bottom: 10px;
    }
    .info {
      background: #E8F5E9;
      padding: 15px;
      border-left: 4px solid #4CAF50;
      margin: 20px 0;
      border-radius: 4px;
    }
    .info h2 {
      margin-top: 0;
      color: #2E7D32;
    }
    #parser-output {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin: 20px 0;
      border: 2px solid #ccc;
    }
    #score-display {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin: 20px 0;
      border: 2px solid #4CAF50;
      min-height: 400px;
    }
    pre {
      background: #f8f8f8;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .success {
      color: #2E7D32;
      font-weight: bold;
    }
    .error {
      color: #C62828;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>üéµ ScoreParser Test - Akatombo</h1>

  <div class="info">
    <h2>Testing Score Parser</h2>
    <p>This page tests the <strong>ScoreParser</strong> class by loading and parsing the Akatombo score.</p>
    <p>The parser converts JSON score data into ShakuNote objects with appropriate modifiers.</p>
    <p><strong>üìù Open the browser console (F12) to see detailed output.</strong></p>
  </div>

  <div id="parser-output">
    <h3>Parser Output</h3>
    <div id="output-content">Loading Akatombo.json...</div>
  </div>

  <div id="score-display">
    <h3>Rendered Score</h3>
    <!-- SVG will be rendered here -->
  </div>

  <script type="module">
    import { ScoreParser } from '/src/parser/ScoreParser.js';
    import { SVGRenderer } from '/src/renderer/SVGRenderer.js';
    import { VerticalSystem } from '/src/renderer/VerticalSystem.js';

    const outputDiv = document.getElementById('output-content');
    const scoreDiv = document.getElementById('score-display');

    async function testParser() {
      try {
        console.log('üéµ Loading Akatombo score...');

        // Load and parse the score
        const notes = await ScoreParser.loadFromURL('/src/data/scores/Akatombo.json');

        console.log('‚úÖ Parsing successful!');
        console.log(`üìä Parsed ${notes.length} notes`);
        console.log('Notes:', notes);

        // Display parsing results
        let html = '<p class="success">‚úÖ Parsing successful!</p>';
        html += `<p>Loaded <strong>${notes.length} notes</strong> from Akatombo.json</p>`;
        html += '<h4>Note Details:</h4>';
        html += '<pre>';

        notes.forEach((note, index) => {
          const kana = note.getKana();
          const duration = note.getDuration();
          const modifiers = note.getModifiers();
          const modifierNames = modifiers.map(m => m.constructor.name).join(', ');

          html += `Note ${index + 1}: ${kana} (duration: ${duration})`;
          if (modifierNames) {
            html += ` [${modifierNames}]`;
          }
          html += '\n';
        });

        html += '</pre>';
        outputDiv.innerHTML = html;

        // Render the score
        console.log('üé® Rendering score...');
        renderScore(notes);

      } catch (error) {
        console.error('‚ùå Error:', error);
        outputDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
      }
    }

    function renderScore(notes) {
      // Create SVG renderer
      const renderer = new SVGRenderer(scoreDiv, 1000, 600);

      // Create vertical system
      const verticalSystem = new VerticalSystem({
        x: 50,
        y: 50,
        columnHeight: 500,
        columnSpacing: 100,
        notesPerColumn: 5
      });

      // Render all notes in vertical columns
      verticalSystem.renderColumns(notes, renderer);

      console.log('‚úÖ Rendering complete!');
    }

    // Run the test
    testParser();
  </script>
</body>
</html>
